<html lang="en">
<head>
    <title>Mikado</title>
</head>
<body>
<h1>Benchmark: Compare Proxy</h1><hr>
<div id="result" style="white-space: pre; font-family: Monospaced, monospace"></div>
<div id="root"></div>
<script src="./dist/mikado.min.js"></script>
<script type="module">

    "use strict";

    import { root, queue, items, shuffle, set_clone } from "./../../bench.js";
    import template from "./template/template.es6.js";
    import proxy from "./template/proxy.es6.js";

    let mikado, mikado_proxy;

    queue.splice(0);

    let clone;

    queue.push({
        name: "create",
        warmup: true,
        loop: 5000,
        init: null,
        test: null,
        start: function(){
            set_clone(clone = shuffle(items).slice(0));
            mikado = new Mikado(root, template, {
                "store": clone,
                "loose": false,
                "reuse": true,
                "cache": true
            });
        },
        fn: function(){
            mikado.render(clone);
        },
        end: function(){
            mikado.clear();
        },
        complete: null
    });

    queue.push({
        name: "create proxy",
        warmup: true,
        loop: 5000,
        init: null,
        test: null,
        start: function(){
            set_clone(clone = shuffle(items).slice(0));
            mikado_proxy = new Mikado(root, proxy, {
                "store": true,
                "loose": false,
                "reuse": true,
                "cache": true,
                "proxy": clone
            });
        },
        fn: function(){
            mikado_proxy.render(clone);
        },
        end: function(){
            mikado_proxy.clear();
        },
        complete: null
    });

    queue.push({
        name: "update",
        warmup: true,
        loop: 5000,
        init: function(){
            set_clone(clone = shuffle(items).slice(0));
            mikado = new Mikado(root, template, {
                "store": clone,
                "loose": false,
                "reuse": true,
                "cache": true
            });
            mikado.render(clone);
        },
        test: null,
        start: null,
        fn: function(){
            for(let i = 0, length = clone.length; i < length; i+=5){
                clone[i]["title"] = Math.random();
                mikado.refresh(i);
            }
        },
        end: null,
        complete: function(){
            mikado.clear();
        }
    });

    queue.push({
        name: "update proxy",
        warmup: true,
        loop: 5000,
        init: function(){
            set_clone(clone = shuffle(items).slice(0));
            mikado_proxy = new Mikado(root, proxy, {
                "store": true,
                "loose": false,
                "reuse": true,
                "cache": true,
                "proxy": clone
            });
            mikado_proxy.render(clone);
        },
        test: null,
        start: null,
        fn: function(){
            for(let i = 0, length = clone.length; i < length; i+=5){
                clone[i]["title"] = Math.random();
            }
        },
        end: null,
        complete: function(){
            mikado_proxy.clear();
        }
    });

</script>
</body>
</html>